import{_ as s,c as a,o as n,a as l}from"./app.471d11cf.js";const C=JSON.parse('{"title":"å®ç°ä¸€ä¸ªå¹½çµä¾èµ–æ‰«æå·¥å…·","description":"","frontmatter":{"title":"å®ç°ä¸€ä¸ªå¹½çµä¾èµ–æ‰«æå·¥å…·","date":"2022-05-15T00:00:00.000Z","tags":["å¤§å‰ç«¯","node.js"],"categories":["å¤§å‰ç«¯"]},"headers":[{"level":2,"title":"ä»€ä¹ˆæ˜¯å¹½çµä¾èµ–","slug":"ä»€ä¹ˆæ˜¯å¹½çµä¾èµ–","link":"#ä»€ä¹ˆæ˜¯å¹½çµä¾èµ–","children":[]},{"level":2,"title":"ç°çŠ¶","slug":"ç°çŠ¶","link":"#ç°çŠ¶","children":[]},{"level":2,"title":"èƒŒæ™¯","slug":"èƒŒæ™¯","link":"#èƒŒæ™¯","children":[{"level":3,"title":"åŒ…ç®¡ç†å·¥å…·åˆ‡æ¢pnpm","slug":"åŒ…ç®¡ç†å·¥å…·åˆ‡æ¢pnpm","link":"#åŒ…ç®¡ç†å·¥å…·åˆ‡æ¢pnpm","children":[]},{"level":3,"title":"ä¸ºä»€ä¹ˆæ˜¯ pnpm","slug":"ä¸ºä»€ä¹ˆæ˜¯-pnpm","link":"#ä¸ºä»€ä¹ˆæ˜¯-pnpm","children":[]},{"level":3,"title":"ä¸ºä»€ä¹ˆåšäº†è¿™ä¸ªå·¥å…·","slug":"ä¸ºä»€ä¹ˆåšäº†è¿™ä¸ªå·¥å…·","link":"#ä¸ºä»€ä¹ˆåšäº†è¿™ä¸ªå·¥å…·","children":[]}]},{"level":2,"title":"åŸç†ä»‹ç»","slug":"åŸç†ä»‹ç»","link":"#åŸç†ä»‹ç»","children":[]},{"level":2,"title":"å…·ä½“å®ç°","slug":"å…·ä½“å®ç°","link":"#å…·ä½“å®ç°","children":[{"level":3,"title":"è·å–æ‰«æç›®æ ‡æ–‡ä»¶","slug":"è·å–æ‰«æç›®æ ‡æ–‡ä»¶","link":"#è·å–æ‰«æç›®æ ‡æ–‡ä»¶","children":[]},{"level":3,"title":"JSèµ„æºå¼•å…¥è·¯å¾„æå–","slug":"jsèµ„æºå¼•å…¥è·¯å¾„æå–","link":"#jsèµ„æºå¼•å…¥è·¯å¾„æå–","children":[]},{"level":3,"title":"CSSèµ„æºå¼•å…¥è·¯å¾„æå–","slug":"cssèµ„æºå¼•å…¥è·¯å¾„æå–","link":"#cssèµ„æºå¼•å…¥è·¯å¾„æå–","children":[]},{"level":3,"title":"Vueæ–‡ä»¶ä¸­å¼•å…¥è·¯å¾„æå–","slug":"vueæ–‡ä»¶ä¸­å¼•å…¥è·¯å¾„æå–","link":"#vueæ–‡ä»¶ä¸­å¼•å…¥è·¯å¾„æå–","children":[]},{"level":3,"title":"ç¬¬ä¸‰æ–¹ä¾èµ–åˆ¤æ–­","slug":"ç¬¬ä¸‰æ–¹ä¾èµ–åˆ¤æ–­","link":"#ç¬¬ä¸‰æ–¹ä¾èµ–åˆ¤æ–­","children":[]},{"level":3,"title":"æå–åŒ…å","slug":"æå–åŒ…å","link":"#æå–åŒ…å","children":[]},{"level":3,"title":"è¿‡æ»¤æ‰ä¸åˆæ³•çš„åŒ…å","slug":"è¿‡æ»¤æ‰ä¸åˆæ³•çš„åŒ…å","link":"#è¿‡æ»¤æ‰ä¸åˆæ³•çš„åŒ…å","children":[]}]},{"level":2,"title":"ä¸Šæ‰‹ä½“éªŒ","slug":"ä¸Šæ‰‹ä½“éªŒ","link":"#ä¸Šæ‰‹ä½“éªŒ","children":[{"level":3,"title":"CLI å·¥å…·","slug":"cli-å·¥å…·","link":"#cli-å·¥å…·","children":[]},{"level":3,"title":"é¡¹ç›®ä¸­è°ƒç”¨","slug":"é¡¹ç›®ä¸­è°ƒç”¨","link":"#é¡¹ç›®ä¸­è°ƒç”¨","children":[]}]},{"level":2,"title":"æœ€å","slug":"æœ€å","link":"#æœ€å","children":[]}],"relativePath":"pages/bigWeb/node/phantom-dep-cli.md","lastUpdated":1678348653000}'),p={name:"pages/bigWeb/node/phantom-dep-cli.md"},o=l(`<h1 id="å®ç°ä¸€ä¸ªå¹½çµä¾èµ–æ‰«æå·¥å…·" tabindex="-1">å®ç°ä¸€ä¸ªå¹½çµä¾èµ–æ‰«æå·¥å…· <a class="header-anchor" href="#å®ç°ä¸€ä¸ªå¹½çµä¾èµ–æ‰«æå·¥å…·" aria-hidden="true">#</a></h1><h2 id="ä»€ä¹ˆæ˜¯å¹½çµä¾èµ–" tabindex="-1">ä»€ä¹ˆæ˜¯å¹½çµä¾èµ– <a class="header-anchor" href="#ä»€ä¹ˆæ˜¯å¹½çµä¾èµ–" aria-hidden="true">#</a></h2><p><strong>é¡¹ç›®ä¸­ä½¿ç”¨äº†ä¸€äº›æ²¡æœ‰è¢«å®šä¹‰åœ¨å…¶ package.json æ–‡ä»¶ä¸­çš„åŒ…ã€‚</strong></p><p>éƒ¨åˆ†åœ°æ–¹ä¹Ÿè¢«ç¿»è¯‘æˆäº†â€å¹»å½±ä¾èµ–â€œï¼Œåœ¨è‹±æ–‡æ–‡ç« ä¸­ä¸€èˆ¬ç§°ä¸º<code>phantom dependencies</code></p><h2 id="ç°çŠ¶" tabindex="-1">ç°çŠ¶ <a class="header-anchor" href="#ç°çŠ¶" aria-hidden="true">#</a></h2><p>åœ¨ç°æœ‰å·¥ç¨‹é‡Œï¼Œé™¤ <code>pnpm</code> å¤–ä½¿ç”¨çš„æœ€å¤šçš„åŒ…ç®¡ç†å·¥å…·å°±æ˜¯ <code>yarn</code> å…¶æ¬¡æ‰æ˜¯ <code>npm</code>ã€‚</p><p>åä¸¤è€…ï¼Œåœ¨å®Œæˆä¾èµ–å®‰è£…åï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªä¾èµ–æå‡çš„åŠ¨ä½œï¼Œä¹Ÿå°±æ˜¯ä¾èµ–çš„ <code>æ‰å¹³åŒ–</code>ã€‚</p><p>äºæ˜¯è£…ä¸€ä¸ªåº“ <code>vue</code>ï¼Œä¸åŒåŒ…ç®¡ç†å™¨çš„ç»“æœå¦‚ä¸‹</p><table><thead><tr><th style="text-align:center;">npm</th><th style="text-align:center;">yarn</th><th style="text-align:center;">pnpm</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="https://img.cdn.sugarat.top/mdImg/MTY1MjYyNDkxNDc0OQ==652624914749" alt="å›¾ç‰‡"></td><td style="text-align:center;"><img src="https://img.cdn.sugarat.top/mdImg/MTY1MjYwNDEyMzUwMQ==652604123501" alt="å›¾ç‰‡"></td><td style="text-align:center;"><img src="https://img.cdn.sugarat.top/mdImg/MTY1MjYwNDIxODMwMA==652604218300" alt="å›¾ç‰‡"></td></tr></tbody></table><p>ç”±äºä¾èµ–çš„<code>æ‰å¹³åŒ–</code>ï¼Œå¯ä»¥çœ‹åˆ°å‰ä¸¤è€…ä¼šä½¿ <code>node_modules</code> ä¸­å¤šå‡ºä¸€äº›å…¶å®ƒçš„ä¸œè¥¿</p><p>ä¹Ÿç”±äºè¿™ä¸ªç‰¹æ€§ï¼Œå¾ˆå¤šåŸºäº <code>yarn</code> çš„å·¥ç¨‹åŒ–æ–¹æ¡ˆï¼Œä¼šå°†è®¸å¤šå¸¸ç”¨çš„ä¾èµ–æˆ–è€…é‡è¦ä¾èµ–å»åšä¸€ä¸ªç‰ˆæœ¬çš„ç®¡æ§å’Œä¾èµ–çš„æ”¶æ•›ï¼Œäºæ˜¯é¡¹ç›®é‡Œéœ€è¦å®‰è£…çš„ä¾èµ–å°±å°‘äº†ï¼Œçœ‹ä¸Šå»å°±ååˆ†æ¸…æ™°ã€‚</p><p>æ¯”å¦‚å®‰è£…<code>@xx/vue</code>ï¼ŒåŒæ—¶å°†ç›¸å…³çš„<code>lint</code>ï¼Œ<code>test-util</code>ï¼Œ<code>git hooks</code>ï¼Œ<code>lodash</code>ï¼Œ<code>xx-utils</code>ç­‰ç­‰åŒ…éƒ½åšäº†å®‰è£…ï¼Œè¿™æ ·åœ¨å·¥ç¨‹é‡Œåªéœ€è¦è£…ä¸€ä¸ªåŒ…å°±èƒ½ä½¿ç”¨è¿™äº›åŒ…çš„èƒ½åŠ›ã€‚è¿™ä¹Ÿç®—æ˜¯<code>å¹½çµä¾èµ–</code>çš„å¥½å¤„ã€‚</p><h2 id="èƒŒæ™¯" tabindex="-1">èƒŒæ™¯ <a class="header-anchor" href="#èƒŒæ™¯" aria-hidden="true">#</a></h2><h3 id="åŒ…ç®¡ç†å·¥å…·åˆ‡æ¢pnpm" tabindex="-1">åŒ…ç®¡ç†å·¥å…·åˆ‡æ¢pnpm <a class="header-anchor" href="#åŒ…ç®¡ç†å·¥å…·åˆ‡æ¢pnpm" aria-hidden="true">#</a></h3><p>éšç€é¡¹ç›®çš„è¿­ä»£æ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Œå·¥ç¨‹é‡Œçš„ä¾èµ–åŒ…è¶Šæ¥è¶Šå¤šã€‚ä¾èµ–å®‰è£…æ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Œå³ä¾¿æœ‰å®‰è£…ç¼“å­˜ï¼Œè¿˜æ˜¯è§‰å¾—éå¸¸çš„æ…¢ã€‚äºæ˜¯æœ‰äº†æ¢ä¾èµ–ç®¡ç†å·¥å…·çš„è¯‰æ±‚ã€‚</p><p>ä¸€ç•ªè°ƒç ”åï¼Œé€‰æ‹©æŠŠåŒ…ç®¡ç†å·¥å…·åˆ‡æ¢ä¸º<code>pnpm</code>ã€‚</p><h3 id="ä¸ºä»€ä¹ˆæ˜¯-pnpm" tabindex="-1">ä¸ºä»€ä¹ˆæ˜¯ pnpm <a class="header-anchor" href="#ä¸ºä»€ä¹ˆæ˜¯-pnpm" aria-hidden="true">#</a></h3><p>é€šè¿‡ pnpm <a href="https://www.pnpm.cn/benchmarks" target="_blank" rel="noreferrer">å®˜æ–¹çš„æµ‹è¯„æ•°æ®</a> å¯ä»¥çœ‹å‡ºï¼Œåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹</p><p>å®‰è£…é€Ÿåº¦æ˜¯ <code>npm/yarn</code> çš„ <code>2-3</code>å€ï¼Œä¸€ä¸ªé¡¹ç›®å°±ç®—èŠ‚çº¦<code>å‡ åç§’</code>ï¼Œå¯¹äºæ‰¿è½½ä¸Šå‰å·¥ç¨‹çš„<code>CI/CD</code>å¹³å°æ¥è¯´ï¼Œå‡ ä¹æ—¶æ—¶åˆ»åˆ»éƒ½å­˜åœ¨å‘å¸ƒçš„æƒ…å†µï¼Œæ¯å¤©çš„æ”¶ç›Šæ˜¯å¾ˆå¯è§‚çš„ã€‚å¯¹äºç”¨æˆ·æ¥è¯´ç­‰å¾…æ—¶é—´ä¹Ÿå¤§å¹…ç¼©çŸ­ã€‚</p><h3 id="ä¸ºä»€ä¹ˆåšäº†è¿™ä¸ªå·¥å…·" tabindex="-1">ä¸ºä»€ä¹ˆåšäº†è¿™ä¸ªå·¥å…· <a class="header-anchor" href="#ä¸ºä»€ä¹ˆåšäº†è¿™ä¸ªå·¥å…·" aria-hidden="true">#</a></h3><p>åœ¨<code>yarn</code>åˆ‡æ¢åˆ°<code>pnpm</code>,å¯ä»¥é€šè¿‡<code>pnpm import</code>æŒ‡ä»¤å®ç°lockæ–‡ä»¶çš„ä¸€é”®è½¬æ¢ï¼Œé¿å…ä¾èµ–ç‰ˆæœ¬å‘ç”Ÿå˜æ›´ã€‚</p><p>ä½†ç”±äº<code>pnpm</code>æ²¡æœ‰ä¾èµ–æ‰å¹³åŒ–çš„åŠ¨ä½œï¼Œå¤§éƒ¨åˆ†é¡¹ç›®åˆ‡æ¢åæ²¡å‘ç›´æ¥æ­£å¸¸å·¥ä½œï¼Œä¸»è¦åŸå› å°±æ˜¯<code>å¹½çµä¾èµ–</code></p><p>éœ€è¦ä¸ºpnpmé¡¹ç›®å•ç‹¬æ·»åŠ <a href="https://www.pnpm.cn/npmrc#public-hoist-pattern" target="_blank" rel="noreferrer">ä¾èµ–æå‡çš„é…ç½®</a></p><p>äºæ˜¯å°±éœ€è¦ä¸€ä¸ªæ‰«æå¹½çµä¾èµ–çš„å·¥å…·ï¼ŒååŠ©åšåŒ…ç®¡ç†å·¥å…·çš„è¿ç§»ã€‚ç½‘ä¸Šæœç´¢äº†ä¸€ç•ªï¼Œæ²¡æœ‰æ‰¾åˆ°èƒ½ç”¨çš„å°±åªå¥½è‡ªå·±ğŸ´ä¸€ä¸ªäº†ã€‚</p><h2 id="åŸç†ä»‹ç»" tabindex="-1">åŸç†ä»‹ç» <a class="header-anchor" href="#åŸç†ä»‹ç»" aria-hidden="true">#</a></h2><p>ä¸€å›¾èƒœåƒè¨€</p><p><img src="https://img.cdn.sugarat.top/mdImg/MTY1MjYwODIzODM1NA==652608238354" alt="å›¾ç‰‡"></p><p>æ€»ç»“ä¸‹å°±æ˜¯4æ­¥</p><ol><li>æ‰«æ–‡ä»¶</li><li>æå–å¯¼å…¥èµ„æºè·¯å¾„</li><li>æå–åŒ…å</li><li>å‰”é™¤<code>package.json</code>ä¸­å­˜åœ¨çš„</li></ol><h2 id="å…·ä½“å®ç°" tabindex="-1">å…·ä½“å®ç° <a class="header-anchor" href="#å…·ä½“å®ç°" aria-hidden="true">#</a></h2><p>è¿™é‡Œåªè´´å‡ ä¸ªå…³é”®æ­¥éª¤çš„ä»£ç ï¼Œä»£ç çš„ç»„ç»‡é€»è¾‘å³ä¸Šè¿°æµç¨‹å›¾æ‰€ç¤º</p><h3 id="è·å–æ‰«æç›®æ ‡æ–‡ä»¶" tabindex="-1">è·å–æ‰«æç›®æ ‡æ–‡ä»¶ <a class="header-anchor" href="#è·å–æ‰«æç›®æ ‡æ–‡ä»¶" aria-hidden="true">#</a></h3><p>è¿™å—åˆ©ç”¨<code>path</code>ä¸<code>fs</code>æ¨¡å—é…åˆå³å¯å®ç°</p><ul><li>ä½¿ç”¨<code>fs.readdirSync</code>è¯»å–æ–‡ä»¶åˆ—è¡¨ï¼Œç„¶åé€’å½’å³å¯</li><li>é€šè¿‡æ–‡ä»¶åç¼€<code>ext</code>ç­›é€‰å‡ºéœ€è¦çš„æ–‡ä»¶</li></ul><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Exclude</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">RegExp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">scanDirFiles</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">extList</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#A6ACCD;">[] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">exclude</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Exclude</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Exclude</span><span style="color:#A6ACCD;">[] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node_modules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.git</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.vscode</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">files</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">readdirSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dir</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> withFileTypes</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;">[] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">file</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">files</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dir</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">file</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isExclude</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">exclude</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">continue</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">file</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isFile</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">&amp;&amp;</span></span>
<span class="line"><span style="color:#F07178;">      (</span><span style="color:#A6ACCD;">extList</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">extList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ext</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">    ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">file</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isDirectory</span><span style="color:#F07178;">()) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">...</span><span style="color:#82AAFF;">scanDirFiles</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">extList</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">exclude</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">isExclude</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">exclude</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Exclude</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Exclude</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">patterns</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">exclude</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">flat</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">patterns</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">v</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">v</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">v</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">v</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>è°ƒç”¨ç¤ºä¾‹</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">scanDirFiles</span><span style="color:#A6ACCD;">(path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(__dirname))</span></span>
<span class="line"><span style="color:#82AAFF;">scanDirFiles</span><span style="color:#A6ACCD;">(path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(__dirname)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.ts</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">])</span></span>
<span class="line"><span style="color:#82AAFF;">scanDirFiles</span><span style="color:#A6ACCD;">(path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(__dirname)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.ts</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><ul><li>js ç³»èµ„æºä¸»è¦åŒ…å«<code>.js</code>,<code>.jsx</code>,<code>.ts</code>,<code>.tsx</code>å››ç±»èµ„æº</li><li>css ç³»èµ„æºåŒ…å«<code>.css</code>,<code>.scss</code>,<code>.less</code>,<code>.sass</code></li><li>vue ä¸»è¦å°±æ˜¯<code>.vue</code><ul><li>åªéœ€è¦æŠŠ <code>script</code> å’Œ <code>style</code>å†…å®¹åˆ†åˆ«æ‹†å¼€å¤„ç†å³å¯</li></ul></li></ul><h3 id="jsèµ„æºå¼•å…¥è·¯å¾„æå–" tabindex="-1">JSèµ„æºå¼•å…¥è·¯å¾„æå– <a class="header-anchor" href="#jsèµ„æºå¼•å…¥è·¯å¾„æå–" aria-hidden="true">#</a></h3><p>è¿™é‡Œä½¿ç”¨ <a href="https://github.com/thx/gogocode" target="_blank" rel="noreferrer">gogocode</a> æ“ä½œASTï¼Œé…åˆ<a href="https://astexplorer.net/" target="_blank" rel="noreferrer">astexplorer</a>ç€ä½¿ç”¨ï¼Œæ“ä½œèµ·æ¥éå¸¸ç®€å•</p><p>å¯¼å…¥æ¨¡å—çš„æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹4ç§</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(value)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">import</span><span style="color:#A6ACCD;">(value)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">import</span><span style="color:#A6ACCD;">(value)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> value</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> value</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">export x </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> value</span></span>
<span class="line"></span></code></pre></div><p><code>import/export</code>æå–</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> AST</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">GoGoAST</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">gogocode</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> sources</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#A6ACCD;">[] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> ast </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AST</span><span style="color:#A6ACCD;">(fileText)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> callback </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">node</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">GoGoAST</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">importPath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">attr</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">source.value</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">sources</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">importPath</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">ast</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ImportDeclaration</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">each</span><span style="color:#A6ACCD;">(callback)</span></span>
<span class="line"><span style="color:#A6ACCD;">ast</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ExportNamedDeclaration</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">each</span><span style="color:#A6ACCD;">(callback)</span></span>
<span class="line"></span></code></pre></div><p><code>require/import()</code>æå–</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> callback </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">node</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">GoGoAST</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">importPath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">match</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">][</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">value</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">sources</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">importPath</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å¤„ç†import(&#39;&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">ast</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">import($_$)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">each</span><span style="color:#A6ACCD;">(callback)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å¤„ç†require(&#39;&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">ast</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">require($_$)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">each</span><span style="color:#A6ACCD;">(callback)</span></span>
<span class="line"></span></code></pre></div><h3 id="cssèµ„æºå¼•å…¥è·¯å¾„æå–" tabindex="-1">CSSèµ„æºå¼•å…¥è·¯å¾„æå– <a class="header-anchor" href="#cssèµ„æºå¼•å…¥è·¯å¾„æå–" aria-hidden="true">#</a></h3><p>é’ˆå¯¹cssï¼Œåªè€ƒè™‘<code>@import</code>åœºæ™¯çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ­£åˆ™ <code>/^@import\\s+[&#39;&quot;](.*)?[&#39;&quot;]/</code>å³å¯å®ç°æå–</p><p><img src="https://img.cdn.sugarat.top/mdImg/MTY1MjYxMDQwMjUxNw==652610402517" alt="å›¾ç‰‡"></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getCssFileImportSource</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">fileText</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sources</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;">[] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">importRegexp</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#C3E88D;">@import\\s</span><span style="color:#89DDFF;">+[</span><span style="color:#C3E88D;">&#39;&quot;</span><span style="color:#89DDFF;">](</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*)?[</span><span style="color:#C3E88D;">&#39;&quot;</span><span style="color:#89DDFF;">]/</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lines</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fileText</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">line</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lines</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">match</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">line</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">trim</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">match</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">importRegexp</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">?.</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">match</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">sources</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">match</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sources</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="vueæ–‡ä»¶ä¸­å¼•å…¥è·¯å¾„æå–" tabindex="-1">Vueæ–‡ä»¶ä¸­å¼•å…¥è·¯å¾„æå– <a class="header-anchor" href="#vueæ–‡ä»¶ä¸­å¼•å…¥è·¯å¾„æå–" aria-hidden="true">#</a></h3><p>ä¸€ä¸ª<code>.vue</code>æ–‡ä»¶ä¸»è¦å°± <code>template</code>, <code>script</code>, <code>style</code>ä¸‰éƒ¨åˆ†æ„æˆï¼Œåªéœ€è¦æŠŠ<code>è„šæœ¬</code>ä¸<code>æ ·å¼</code>æ‹†å¼€å¤„ç†å³å¯</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> AST </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">gogocode</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getVueFileImportSource</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">fileText</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sources</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;">[] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ç›®å‰å‘ç°Vue3 &lt;script lang=&quot;ts&quot; setup&gt; çš„æ— æ³•æ­£å¸¸è§£æï¼Œæ‰€ä»¥åœ¨è§£æå‰å…ˆå¤„ç†ä¸€ä¸‹setupå…³é”®å­—</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ast</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">AST</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">fileText</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">&lt;script</span><span style="color:#89DDFF;">(</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*)</span><span style="color:#C3E88D;">setup</span><span style="color:#89DDFF;">(</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*)</span><span style="color:#C3E88D;">&gt;</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&lt;script$1$2&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    parseOptions</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> language</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æå–scriptå†…å®¹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">script</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ast</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&lt;script&gt;&lt;/script&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">generate</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">trim</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">sources</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">...</span><span style="color:#82AAFF;">getJsFileImportSource</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">script</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// cssç›´æ¥æ­£åˆ™å¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">sources</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">...</span><span style="color:#82AAFF;">getCssFileImportSource</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">fileText</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sources</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="ç¬¬ä¸‰æ–¹ä¾èµ–åˆ¤æ–­" tabindex="-1">ç¬¬ä¸‰æ–¹ä¾èµ–åˆ¤æ–­ <a class="header-anchor" href="#ç¬¬ä¸‰æ–¹ä¾èµ–åˆ¤æ–­" aria-hidden="true">#</a></h3><p>èµ„æºè·¯å¾„æå–å‡ºæ¥åï¼Œå°±åªéœ€è¦åˆ¤æ–­è·¯å¾„æ˜¯å¦æ˜¯node_modulesä¸‹çš„èµ„æºå³å¯äº†ï¼Œæµç¨‹å¦‚ä¸‹</p><p><img src="https://img.cdn.sugarat.top/mdImg/MTY1MjYyNDQ2ODAyNw==652624468027" alt="å›¾ç‰‡"></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> path</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">parse</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">existsSync</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">isValidNodeModulesSource</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">filePath</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">importSourcePath</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dir</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filePath</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">importSourcePath</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">importSourcePath</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node_modules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">~@/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\`</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">some</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">prefix</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">importSourcePath</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">startsWith</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">prefix</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    )</span></span>
<span class="line"><span style="color:#F07178;">  ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">cssExt</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">jsExt</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">some</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">ext</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">existsSync</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dir</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`\${</span><span style="color:#A6ACCD;">importSourcePath</span><span style="color:#89DDFF;">}\${</span><span style="color:#A6ACCD;">ext</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">    )</span></span>
<span class="line"><span style="color:#F07178;">  ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="æå–åŒ…å" tabindex="-1">æå–åŒ…å <a class="header-anchor" href="#æå–åŒ…å" aria-hidden="true">#</a></h3><p>æ¥ä¸‹æ¥å°±æ˜¯ä»ç­›é€‰å‡ºæ¥çš„<code>æœ‰æ•ˆèµ„æºè·¯å¾„</code>é‡Œæå–å‡ºåŒ…åäº†ï¼Œé€šå¸¸å°±ä¸¤ç§åœºæ™¯<code>pkgName</code>å’Œ<code>@scope/pkgName</code>ï¼Œé€šè¿‡å‡ ä¸ªå¸¸ç”¨çš„APIå°±èƒ½æå®š</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getPkgNameBySourcePath</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">pkgPath</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">paths</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pkgPath</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">~</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">g</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*</span><span style="color:#C3E88D;">node_modules</span><span style="color:#A6ACCD;">\\/</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">paths</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">startsWith</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">paths</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">slice</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">paths</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">test</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">getPkgNameBySourcePath</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">expect</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">getPkgNameBySourcePath</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toBe</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">expect</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">getPkgNameBySourcePath</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vue/ssr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toBe</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vue/ssr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">expect</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">getPkgNameBySourcePath</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue/dist/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toBe</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">expect</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">getPkgNameBySourcePath</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../node_modules/vue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toBe</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">expect</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">getPkgNameBySourcePath</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">~@element/ui/dist/index.css</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toBe</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@element/ui</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="è¿‡æ»¤æ‰ä¸åˆæ³•çš„åŒ…å" tabindex="-1">è¿‡æ»¤æ‰ä¸åˆæ³•çš„åŒ…å <a class="header-anchor" href="#è¿‡æ»¤æ‰ä¸åˆæ³•çš„åŒ…å" aria-hidden="true">#</a></h3><p>ä¸Šè¿°è§„åˆ™ä¸èƒ½æ¶µç›–åˆ°æ‰€æœ‰æƒ…å†µï¼Œå–åˆ°çš„åŒ…åå¯èƒ½æœ‰ä¸åˆæ³•çš„å¦‚<code>this.xxx</code>,<code>xx.resolve(yyy)</code>,<code>Nodeå†…ç½®çš„åŒ… fs/path/process/...etc</code></p><p>é’ˆå¯¹Nodeå†…ç½®çš„åŒ…å¯ä»¥ç›´æ¥å†™ä¸ªæ­£åˆ™æå®š,å½“ç„¶è¿™æ®µæ­£åˆ™æ¥æºäº<code>Copilot</code>æ¨è</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">isNodeLib(v:</span><span style="color:#A6ACCD;"> string) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/^</span><span style="color:#89DDFF;">(?</span><span style="color:#A6ACCD;">:assert</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">buffer</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">child_process</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">cluster</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">console</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">constants</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">crypto</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">dgram</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">dns</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">domain</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">events</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">fs</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">http</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">module</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">net</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">os</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">path</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">punycode</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">querystring</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">readline</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">repl</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">stream</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">string_decoder</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">sys</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">timers</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">tls</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">tty</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">url</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">util</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">vm</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">zlib</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">$</span><span style="color:#C3E88D;">/.test</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">v</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å½“ç„¶ä¹Ÿæœ‰ç°æˆçš„ç¬¬ä¸‰æ–¹åŒ…å¯ä»¥ç›´æ¥ä½¿ç”¨ <a href="https://www.npmjs.com/package/validate-npm-package-name" target="_blank" rel="noreferrer">validate-npm-package-name</a> ,è¿™ä¸ªæ˜¯å®˜æ–¹å‡ºå“çš„ï¼Œç”¨æ³•ä¹Ÿå°±æ›´åŠ ç®€å•äº†</p><ul><li>ä¸ä»…ä»…èƒ½è¿‡æ»¤æ‰Nodeå†…ç½®åŒ…ï¼Œè¿˜èƒ½è¿‡æ»¤æ‰ä¸åˆæ³•å‘½åçš„åŒ…</li></ul><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> validPkgName </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">validate-npm-package-name</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">isValidPkgName</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">pkgName</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">validForNewPackages</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">validForOldPackages</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">validPkgName</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">pkgName</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">validForNewPackages</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">test</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">isValidPkgName</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">expect</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">isValidPkgName</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toBe</span><span style="color:#F07178;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">expect</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">isValidPkgName</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">some-package</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toBe</span><span style="color:#F07178;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">expect</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">isValidPkgName</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@jane/foo.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toBe</span><span style="color:#F07178;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">expect</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">isValidPkgName</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">r.resolve(&quot;custom-token.js&quot;)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toBe</span><span style="color:#F07178;">(</span><span style="color:#FF9CAC;">false</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">expect</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">isValidPkgName</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dayjs/dsds/abc.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toBe</span><span style="color:#F07178;">(</span><span style="color:#FF9CAC;">false</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>å…³é”®ä¸€ç³»åˆ—æ–¹æ³•æå®šåï¼Œåªéœ€è¦è¿›è¡Œé€»è¾‘çš„ç»„ç»‡å³å¯ï¼Œ<a href="https://github.com/ATQQ/tools/blob/8e0a79d093b3f03a47adff4d7fc0569f19a398e4/packages/cli/ghost/src/util/index.ts#L15-L81" target="_blank" rel="noreferrer">GithubæŸ¥çœ‹æœ€ç»ˆæ–¹æ³•æºç </a></p><h2 id="ä¸Šæ‰‹ä½“éªŒ" tabindex="-1">ä¸Šæ‰‹ä½“éªŒ <a class="header-anchor" href="#ä¸Šæ‰‹ä½“éªŒ" aria-hidden="true">#</a></h2><p>å·²å°†æœ€ç»ˆå®ç°æ•´æˆäº†<code>npm</code>åŒ…<code>@sugarat/ghost</code>ï¼Œé¡¹ç›®å¯å¼•å…¥ç›´æ¥ä½¿ç”¨</p><p>ä¸ºä»€ä¹ˆå«<code>ghost</code>è€Œä¸æ˜¯<code>phantom</code>ï¼Ÿå¯èƒ½å¤§å®¶å¯¹<code>ghost</code>ğŸ‘»è¿™ä¸ªå•è¯çš„æ„æ€æ›´åŠ ç†Ÿæ‚‰ä¸€äº›</p><h3 id="cli-å·¥å…·" tabindex="-1">CLI å·¥å…· <a class="header-anchor" href="#cli-å·¥å…·" aria-hidden="true">#</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@sugarat/ghost</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default scan src </span></span>
<span class="line"><span style="color:#FFCB6B;">ghost</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">scan</span></span>
<span class="line"></span></code></pre></div><h3 id="é¡¹ç›®ä¸­è°ƒç”¨" tabindex="-1">é¡¹ç›®ä¸­è°ƒç”¨ <a class="header-anchor" href="#é¡¹ç›®ä¸­è°ƒç”¨" aria-hidden="true">#</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@sugarat/ghost</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># or</span></span>
<span class="line"><span style="color:#FFCB6B;">yarn</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@sugarat/ghost</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># or</span></span>
<span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@sugarat/ghost</span></span>
<span class="line"></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">findGhost</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@sugarat/ghost</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// or</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">findPhantom</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@sugarat/ghost</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> phantomDependency </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findGhost</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">package.json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="æœ€å" tabindex="-1">æœ€å <a class="header-anchor" href="#æœ€å" aria-hidden="true">#</a></h2><p><code>pnpm</code> æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œæ¨èå¤§å®¶å¯ä»¥ç”¨èµ·æ¥äº†</p><p>æ¬¢è¿è¯„è®ºåŒºäº¤æµæŒ‡æ­£ï¼Œæœ‰ <code>case</code> å¯ä»¥æŠ›å‡ºæ¥å¸®åŠ©å·¥å…·å®Œå–„å¾—æ›´å¥½</p><ul><li><a href="https://github.com/ATQQ/tools/tree/main/packages/cli/ghost" target="_blank" rel="noreferrer">é¡¹ç›®å®Œæ•´æºç </a></li></ul>`,83),e=[o];function t(c,r,F,y,D,i){return n(),a("div",null,e)}const d=s(p,[["render",t]]);export{C as __pageData,d as default};
